<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>


<script>
    function arithmetic(expression) {
        // Function to evaluate RPN
        function evaluateRPN(tokens) {
            let stack = [];
            for (let token of tokens) {
                if (!isNaN(token)) {
                    stack.push(parseFloat(token));
                } else {
                    let b = stack.pop();
                    let a = stack.pop();
                    switch (token) {
                        case '+':
                            stack.push(a + b);
                            break;
                        case '-':
                            stack.push(a - b);
                            break;
                        case '*':
                            stack.push(a * b);
                            break;
                        case '/':
                            stack.push(a / b);
                            break;
                        case '%':
                            stack.push(a % b);
                            break;
                        case '^':
                            stack.push(Math.pow(a, b));
                            break;
                    }
                }
            }
            return stack[0];
        }

        // Function to convert infix expression to RPN
        function infixToRPN(expression) {
            let precedence = { '+': 1, '-': 1, '*': 2, '/': 2, '%': 2, '^': 3 };
            let output = [];
            let operators = [];
            let tokens = expression.match(/\d+(\.\d+)?|[^\d\s]/g);

            for (let token of tokens) {
                if (!isNaN(token)) {
                    output.push(token);
                } else if (token === '(') {
                    operators.push(token);
                } else if (token === ')') {
                    while (operators.length && operators[operators.length - 1] !== '(') {
                        output.push(operators.pop());
                    }
                    operators.pop(); // Remove '('
                } else {
                    while (operators.length && precedence[operators[operators.length - 1]] >= precedence[token]) {
                        output.push(operators.pop());
                    }
                    operators.push(token);
                }
            }

            while (operators.length) {
                output.push(operators.pop());
            }

            return output;
        }

        // Function to remove extra spaces and handle parentheses
        function cleanExpression(expression) {
            let clean = expression.replace(/\s+/g, '');
            return clean;
        }

        let cleanedExpression = cleanExpression(expression);
        let rpnTokens = infixToRPN(cleanedExpression);
        return evaluateRPN(rpnTokens);
    }

    console.log(arithmetic("1+2*3")); // 7
    console.log(arithmetic("3^2%5")); // 4
    console.log(arithmetic("(-1-2)^3/9")); // -3
</script>
</body>
</html>